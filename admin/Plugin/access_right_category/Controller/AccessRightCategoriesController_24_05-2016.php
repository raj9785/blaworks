<?php/** * @license MIT License (http://www.opensource.org/licenses/mit-license.php) * * PHP version 5 * CakePHP version 1.3 *//** * Fares Users Controller * * @package Fares * @subpackage users.controllers */class AccessRightCategoriesController extends AccessRightCategoryAppController {    /**     * Controller name     *     * @var string     */    var $name = 'AccessRightCategories';    /**     * Helpers     *     * @var array     */    public $helpers = array('Html', 'Form', 'Session', 'Time', 'Text');    //public $paginate = array('limit'=>5,'order'=>'Country.id','page'=>1);    /**     * Components     *     * @var array     */    public $components = array('Auth', 'Session', 'Email', 'Cookie', 'Search.Prg', 'RequestHandler');    public $presetVars = array(	array('field' => 'farecategory_id', 'type' => 'value'),	array('field' => 'state_id', 'type' => 'value'),	array('field' => 'city_id', 'type' => 'value'),    );    // public $presetVars = 	true;    public function beforeFilter() {	parent::beforeFilter();	$this->set('model', $this->modelClass);    }    function index() { //echo "yo";die;	// Breadcrumb	$this->set('tab_open', 'accessrightcategory');	$pages[__('Dashboard', true)] = array('plugin' => false, 'controller' => '/');	$breadcrumb = array('pages' => $pages, 'active' => __(' Access Right Category', true));	$this->set('breadcrumb', $breadcrumb);	$pageHeading = 'Access Rights Category Management';	$this->set('pageHeading', $pageHeading);// Pagging	if (!empty($this->data) && isset($this->data['recordsPerPage'])) {	    $limitValue = $limit = $this->data['recordsPerPage'];	    $this->Session->write($this->name . '.' . $this->action . '.recordsPerPage', $limit);	} else {	    $this->Prg->commonProcess();	}	$limitValue = $limit = ($this->Session->read($this->name . '.' . $this->action . '.recordsPerPage') ) ? $this->Session->read($this->name . '.' . $this->action . '.recordsPerPage') : Configure::read('defaultPaginationLimit');	$this->set('limitValue', $limitValue);	$this->set('limit', $limit);	$this->{$this->modelClass}->data[$this->modelClass] = $this->passedArgs;	@$parsedConditions = $this->{$this->modelClass}->parseCriteria($this->passedArgs);	$conditions = array();	if (!empty($this->request->query)) {	    if (isset($this->request->query['name']) && $this->request->query['name'] != "") {		array_push($conditions, array('AccessRightCategory.name LIKE' => "%" . $this->request->query['name'] . "%"));		$this->set("name", $this->request->query['name']);	    }		/*	    if ((isset($this->request->query['from_date']) && $this->request->query['from_date'] != "") && (isset($this->request->query['to_date']) && $this->request->query['to_date'] != "")) {		array_push($conditions, array('(AccessRightCategory.created >= ? AND AccessRightCategory.created <= ? )' => array($this->request->query['from_date'], $this->request->query['to_date'])));		$this->set("from_date", $this->request->query['from_date']);		$this->set("to_date", $this->request->query['to_date']);	    }*/					if(@$this->request->query['from_date'] and @$this->request->query['to_date']) {		    array_push($conditions, array('(FROM_UNIXTIME(AccessRightCategory.created, "%Y-%m-%d") >= ? AND FROM_UNIXTIME(AccessRightCategory.created, "%Y-%m-%d") <= ?)' => array($this->request->query['from_date'], $this->request->query['to_date'])));		    } else			if(@$this->request->query['from_date']) {		    array_push($conditions, array('FROM_UNIXTIME(AccessRightCategory.created, "%Y-%m-%d") >= ' => $this->request->query['from_date']));		    } else			if(@$this->request->query['to_date']) {		    array_push($conditions, array('FROM_UNIXTIME(AccessRightCategory.created, "%Y-%m-%d") <= ' => $this->request->query['to_date']));		    }		    $this->set("from_date", @$this->request->query['from_date']);			$this->set("to_date", @$this->request->query['to_date']);			}	$page = ((isset($this->params['named']['page']) && $this->params['named']['page'] != NULL) ? $this->params['named']['page'] : 0);	$this->set('page', $page);	$this->paginate = array(	    'conditions' => array($conditions),	    'limit' => $limit,	    'order' => array($this->modelClass . '.id' => 'desc')	);	$this->set('parsedConditions', $parsedConditions);	//pr($this->paginate());	$this->set('result', $this->paginate());			$count_new_bookings = $this->AccessRightCategory->find('count', array(            'conditions' => array($conditions),        ));    $this->set("count_new_bookings", $count_new_bookings);    }    public function change_status_active() {	if ($this->request->is('Ajax')) {	    if ($this->data['id'] != null) {		$data['status'] = 1;		$this->{$this->modelClass}->id = $this->data['id'];		$this->{$this->modelClass}->save($data, false);		echo json_encode(array('succ' => 1, 'msg' => 'Record Status has been changed.'));		die;	    }	}	exit;    }    public function change_status_inactive() {	if ($this->request->is('Ajax')) {	    if ($this->data['id'] != null) {		$data['status'] = 0;		$this->{$this->modelClass}->id = $this->data['id'];		$this->{$this->modelClass}->save($data, false);		echo json_encode(array('succ' => 1, 'msg' => 'Record Status has been changed.'));		die;	    }	}	exit;    }    public function deleterow() {	if ($this->request->is('Ajax')) {	    if ($this->data['id'] != null) {		$data = $this->{$this->modelClass}->findById($this->data['id']);		$this->loadModel('AccessPermission');		$this->AccessPermission->deleteAll(array('access_right_category_id' => $this->data['id']));		if (!empty($data)) {		    if ($this->{$this->modelClass}->delete($this->data['id'])) {			echo json_encode(array('succ' => 1, 'msg' => 'Record has been deleted'));			die;		    }		}	    }	}	exit;    }    function add() {	$this->set('tab_open', 'accessrightcategory');	$pages[__('Dashboard', true)] = array('plugin' => false, 'controller' => '/');	$breadcrumb = array('pages' => $pages, 'active' => __('Access Rights Category Management', true));	$this->set('breadcrumb', $breadcrumb);	$pageHeading = 'Access Rights Category Management';	$this->set('pageHeading', $pageHeading);	if (!empty($this->data)) {	    //pr($this->data); die;	    $this->{$this->modelClass}->set($this->data);	    if ($this->{$this->modelClass}->CheckValidCategory()) {		if ($this->{$this->modelClass}->save($this->data, false)) {		    $userid = $this->{$this->modelClass}->id;		    $this->{$this->modelClass}->AccessPermission->savePermission($userid, $this->data);		    $this->Session->setFlash('Category has been added.', 'success');		    $this->redirect(array('action' => 'index'));		}	    }	}    }    function edit($id = null) {	$this->set('tab_open', 'accessrightcategory');	$pages[__('Dashboard', true)] = array('plugin' => false, 'controller' => '/');	$breadcrumb = array('pages' => $pages, 'active' => __('Access Rights Category Management', true));	$this->set('breadcrumb', $breadcrumb);	$pageHeading = 'Access Rights Category Management';	$this->set('pageHeading', $pageHeading);	$this->set('id', $id);	$user = $this->{$this->modelClass}->findById($id);	$this->{$this->modelClass}->set($user);	$this->set('record', $user);	if (!empty($this->data)) {	    $this->{$this->modelClass}->id = $id;	    $this->{$this->modelClass}->set($this->data);	    if ($this->{$this->modelClass}->CheckValidCategory()) {		if ($this->{$this->modelClass}->save($this->data, false)) {		    $this->loadModel('AccessPermission');		    $this->AccessPermission->deleteAll(array('AccessPermission.access_right_category_id' => $id));		    $userid = $id;		    $this->{$this->modelClass}->AccessPermission->savePermission($userid, $this->data);		    $this->Session->setFlash('Category & Permissions has been updated.', 'success');		    $this->redirect(array('action' => 'edit', $id));		}	    } else {		$this->Session->setFlash('Category not updated.', 'error');		$this->redirect(array('action' => 'edit', $id));	    }	} else {	    $this->{$this->modelClass}->virtualFields = array(		'dashboard' => 'Select field_value From access_permissions Where field_name="dashboard" AND access_right_category_id=' . $id,		'booking' => 'Select field_value From access_permissions Where field_name="booking" AND access_right_category_id=' . $id,		'receipts' => 'Select field_value From access_permissions Where field_name="receipts" AND access_right_category_id=' . $id,		'customer' => 'Select field_value From access_permissions Where field_name="customer" AND access_right_category_id=' . $id,		'vehicle_model' => 'Select field_value From access_permissions Where field_name="vehicle_model" AND access_right_category_id=' . $id,		'permit' => 'Select field_value From access_permissions Where field_name="permit" AND access_right_category_id=' . $id,		'specials' => 'Select field_value From access_permissions Where field_name="specials" AND access_right_category_id=' . $id,		'railway' => 'Select field_value From access_permissions Where field_name="railway" AND access_right_category_id=' . $id,		'bus_stand' => 'Select field_value From access_permissions Where field_name="bus_stand" AND access_right_category_id=' . $id,		'customer_invoice' => 'Select field_value From access_permissions Where field_name="customer_invoice" AND access_right_category_id=' . $id,		'vendor_invoice' => 'Select field_value From access_permissions Where field_name="vendor_invoice" AND access_right_category_id=' . $id,		'vendor_payment' => 'Select field_value From access_permissions Where field_name="vendor_payment" AND access_right_category_id=' . $id,		'payu_panel' => 'Select field_value From access_permissions Where field_name="payu_panel" AND access_right_category_id=' . $id,		'ezetap_panel' => 'Select field_value From access_permissions Where field_name="ezetap_panel" AND access_right_category_id=' . $id,		'driver' => 'Select field_value From access_permissions Where field_name="driver" AND access_right_category_id=' . $id,		'corporatebusiness' => 'Select field_value From access_permissions Where field_name="corporatebusiness" AND access_right_category_id=' . $id,		'vehicle_category' => 'Select field_value From access_permissions Where field_name="vehicle_category" AND access_right_category_id=' . $id,		'vehicle_manufacturer' => 'Select field_value From access_permissions Where field_name="vehicle_manufacturer" AND access_right_category_id=' . $id,		'team' => 'Select field_value From access_permissions Where field_name="team" AND access_right_category_id=' . $id,		'country' => 'Select field_value From access_permissions Where field_name="country" AND access_right_category_id=' . $id,		'state' => 'Select field_value From access_permissions Where field_name="state" AND access_right_category_id=' . $id,		'city' => 'Select field_value From access_permissions Where field_name="city" AND access_right_category_id=' . $id,		'airport' => 'Select field_value From access_permissions Where field_name="airport" AND access_right_category_id=' . $id,		'superdestination' => 'Select field_value From access_permissions Where field_name="superdestination" AND access_right_category_id=' . $id,		'moredestination' => 'Select field_value From access_permissions Where field_name="moredestination" AND access_right_category_id=' . $id,		'fare_category' => 'Select field_value From access_permissions Where field_name="fare_category" AND access_right_category_id=' . $id,		'fare_time_management' => 'Select field_value From access_permissions Where field_name="fare_time_management" AND access_right_category_id=' . $id,		'customer_fare' => 'Select field_value From access_permissions Where field_name="customer_fare" AND access_right_category_id=' . $id,		'vendor_fare' => 'Select field_value From access_permissions Where field_name="vendor_fare" AND access_right_category_id=' . $id,		'charges_management' => 'Select field_value From access_permissions Where field_name="charges_management" AND access_right_category_id=' . $id,		'promotion_code' => 'Select field_value From access_permissions Where field_name="promotion_code" AND access_right_category_id=' . $id,		'feedback_rating' => 'Select field_value From access_permissions Where field_name="feedback_rating" AND access_right_category_id=' . $id,		'transaction' => 'Select field_value From access_permissions Where field_name="transaction" AND access_right_category_id=' . $id,		'testimonial' => 'Select field_value From access_permissions Where field_name="testimonial" AND access_right_category_id=' . $id,		'pages' => 'Select field_value From access_permissions Where field_name="pages" AND access_right_category_id=' . $id,		'terms' => 'Select field_value From access_permissions Where field_name="terms" AND access_right_category_id=' . $id,		'faqs' => 'Select field_value From access_permissions Where field_name="faqs" AND access_right_category_id=' . $id,		'refund_management' => 'Select field_value From access_permissions Where field_name="refund_management" AND access_right_category_id=' . $id,		'taxi_management' => 'Select field_value From access_permissions Where field_name="taxi_management" AND access_right_category_id=' . $id,	    );	    $this->request->data = $this->{$this->modelClass}->read();	}    }    function access_category() { //echo "yo";die;	// Breadcrumb	$this->set('tab_open', 'accessrightuser');	$pages[__('Dashboard', true)] = array('plugin' => false, 'controller' => '/');	$breadcrumb = array('pages' => $pages, 'active' => __(' Access Right Category', true));	$this->set('breadcrumb', $breadcrumb);	$pageHeading = 'Manage Access Right';	$this->set('pageHeading', $pageHeading);// Pagging	if (!empty($this->data) && isset($this->data['recordsPerPage'])) {	    $limitValue = $limit = $this->data['recordsPerPage'];	    $this->Session->write($this->name . '.' . $this->action . '.recordsPerPage', $limit);	} else {	    $this->Prg->commonProcess();	}	$limitValue = $limit = ($this->Session->read($this->name . '.' . $this->action . '.recordsPerPage') ) ? $this->Session->read($this->name . '.' . $this->action . '.recordsPerPage') : Configure::read('defaultPaginationLimit');	$this->set('limitValue', $limitValue);	$this->set('limit', $limit);	$this->{$this->modelClass}->data[$this->modelClass] = $this->passedArgs;	@$parsedConditions = $this->{$this->modelClass}->parseCriteria($this->passedArgs);	$this->paginate = array(	    'conditions' => array($parsedConditions),	    'limit' => $limit,	    'order' => array($this->modelClass . '.id' => 'desc')	);	$this->set('parsedConditions', $parsedConditions);	//pr($this->paginate());	$this->set('result', $this->paginate());    }}